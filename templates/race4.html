{% extends "index4.html" %}
{% load staticfiles %}
{% block content %}
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
	<h1 class="h2">Текущие рейсы</h1>
	<div class="btn-toolbar mb-2 mb-md-0">
	  <div class="btn-group mr-2">
		<a id="add_race" href="{% url 'RaceCreate' %}"
		   class="btn btn-secondary btn-sm" title="Добавить рейс">
		   <i class="fas fa-calendar-plus"></i></a>
		<button id="change_race" href="" class="btn btn-secondary btn-sm"
		   title="Изменить рейс">
		   <i class="fas fa-edit"></i></button>
		<button id="delete_race" data-url="{% url 'RaceDelete' %}" class="btn btn-secondary btn-sm"
		   title="Удалить рейс">
		   <i class="fas fa-trash-alt"></i></button>
		<button id="update_state_from_race" data-url="{% url 'RaceUpdateAjax' %}"  class="btn btn-secondary btn-sm"
		   title="Обновить статус">
		   <i class="fas fa-bookmark"></i></button>
	  </div>
	  <div class="btn-group mr-2">
			<button id="packing_list" type="submit" class="btn btn-secondary btn-sm"
					title="Товарная накладная">
				<i class="fas fa-list-alt"></i></button>
			<button id="way_list" type="submit" class="btn btn-secondary btn-sm" title="Путевой лист">
				<i class="fas fa-road"></i>
			</button>
			<button class="btn btn-secondary btn-sm" title="Экспорт в эксель"
					onclick="$('#race_table').tableExport({type: 'excel', fileName: 'Таблица',
						ignoreColumn: ['checkbox', 'number']});">
				<i class="fas fa-file-excel"></i>
			</button>
	  </div>
	  
		<div class="input-group input-group-sm date calendar-shift" id="datetimepicker">
			<form id="push_date" action="" method="get">
				<div class="input-group input-group-sm">
					<div class="input-group-prepend"><span class="input-group-text" id="daterange-calendar"><i class="fas fa-calendar"></i></span></div>
					<input type="text" class="form-control" name="daterange" style="width: 11rem"
						   value="{{ start_date }} - {{ end_date }}  " aria-describedby="daterange-calendar">
				</div>
			</form>
		</div>
	  
	</div>
  </div>
    <div class="container-fluid">
        <table id="race_table" data-toolbar="#toolbar" data-id-field="id" data-filter-show-clear="true"
               data-toggle="table" data-search="false" data-filter-control="true" data-buttons-align="right"
               data-click-to-select="false" data-side-pagination="client" data-search-align="right"
               data-show-toggle="true"
               data-classes="table table-sm table-hover table-small-font table-condensed table-no-bordered input-group-sm"
			   data-buttons-class="sm">
            <thead class="small">
            <tr>
                <th data-field="checkbox" data-checkbox="true"></th>
	              <th data-field="id" data-visible="false"></th>
                <th data-field="number">#</th>
                <th data-field="race_id">Код</th>
                <th data-field="date" data-filter-control="input">Дата</th>
                <th data-tableexport-value="Машина" data-field="car" data-sortable="true" data-filter-control="select">
                    Машина
                </th>
                <th data-tableexport-value="Водитель" data-field="driver" data-sortable="true"
                    data-filter-control="select">Водитель
                </th>
                <th data-field="operation">Операция</th>
                <th data-field="supplier" data-sortable="true" data-filter-control="select">Поставщик</th>
                <th data-field="customer" data-sortable="true" data-filter-control="select">Клиент</th>
                <th data-field="place_unload" data-visible="false">Место разгрузки</th>
                <th data-field="product" data-filter-control="select">Груз</th>
                <th data-field="s_milage" data-visible="false">Начало трека</th>
                <th data-field="e_milage" data-visible="false">Конец трека</th>
                <th data-field="gas_start" data-visible="false">Горючего на начало</th>
                <th data-field="gas_end" data-visible="false">Горючего на конец</th>
                <th data-field="gas_given" data-visible="false">Горючего выдано</th>
                <th data-field="loaded">Загружено</th>
                <th data-field="unloaded">Выгружено</th>
                <th data-field="shoulder" data-visible="false">Плечо</th>
                <th data-field="count" data-visible="false">Кол-во рейсов</th>
                <th data-field="price" data-visible="true">Цена</th>
                <th data-field="state" data-cell-style="CellStyle">Состояние</th>
            </tr>
            </thead>
            <tbody>
            {% if qRace %}
                {% for q in qRace %}
                    <tr id="{{ q.pk }}">
                        <td></td>
                        <td>{{ q.pk }}</td>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ q.pk }}</td>
                        <td>{{ q.race_date }}</td>
                        <td>{{ q.car }}</td>
                        <td>{{ q.driver }}</td>
                        <td>{{ q.type_ship }}</td>
                        <td>{{ q.supplier }}</td>
                        <td>{{ q.customer }}</td>
                        <td>{{ q.shipment|default_if_none:"Нет" }}</td>
                        <td>{{ q.product }}</td>
                        <td>{{ q.s_milage }}</td>
                        <td>{{ q.e_milage }}</td>
                        <td>{{ q.gas_start }}</td>
                        <td>{{ q.gas_end }}</td>
                        <td>{{ q.gas_given }}</td>
                        <td>{{ q.weight_load }}{{ q.unit_load.short_name }}</td>
                        <td>{{ q.weight_unload }}{{ q.unit_unload.short_name }}</td>
												<td>{{ q.shoulder}}</td>
                        <td>{{ q.count }}</td>
                        <td>{{ q.price }}</td>
                        <td>{{ q.state }}</td>
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>
        </table>
    </div>


    <div id="ModalUpdate" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Подтверждение</h4>
                </div>
                <div id="modal-body-state" class="modal-body">
                    <p>Вы хотите обновить все выбранные статусы?</p>
                    <p class="text-warning">
                        <small>Подумайте, перед обновлением ;).</small>
                    </p>
                </div>
                <div class="modal-footer">
                    <select id="status_select" class="btn btn-success" name="state" required>
                        {% for row in select_state %}
                            <option value="{{ row }}">{{ row }}</option>
                        {% endfor %}
                    </select>
                    <button id="update_state_ok" class="btn btn-primary">Обновить</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                    <input type="hidden" name="next" value="{{ request.path }}">
                </div>
            </div>
        </div>
    </div>


    <div id="ModalPackingList" class="modal fade" data-url="{% url 'PackAjax' %} ">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Подтверждение</h4>
                </div>
                <div class="modal-body">
                    <div class="list-group">
                        <div id="result_pack">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>


    <div id="ModalWayList" class="modal fade" data-url="{% url 'WayAjax' %}">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Подтверждение</h4>
                </div>
                <div class="modal-body">
                    <div class="list-group">
                        <div id="result_way">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>


    <div id="ModalMessage" class="modal fade">
        <div class="modal-dialog">

            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Удаление рейсов</h4>
                </div>

                <div id="id_modal_message" class="modal-body">
                </div>

                <div class="modal-footer">
                    <button id="delete_race_ok" type="button" class="btn btn-success">Да</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Нет</button>
                </div>
            </div>

        </div>
    </div>
    </div>
</main>		
{% endblock %}

