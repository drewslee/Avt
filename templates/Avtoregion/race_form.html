{% extends "index.html" %}
{% load bootstrap3 %}
{% load staticfiles %}
{% block content %}
    <div class="container table-responsive">
        {% include 'messages.html' %}
        <form action="{% url 'RaceCreate' %}" method="post">
            {% csrf_token %}
            {% for field in form %}
                {% bootstrap_field field %}
            {% endfor %}
            {% buttons %}
                <button class="btn btn-success"> {% bootstrap_icon "star" %} Добавить</button>
            {% endbuttons %}
        </form>
    </div>
    <script type="text/javascript">
        $(function () {
            $('input[name="arrival_time"]').daterangepicker({
                "singleDatePicker": true,
                "autoApply": true,
                "timePicker": true,
                "timePicker24Hour": true,
                "startDate": new Date(),
                "endDate" : new Date(),
                locale: {
                    "monthNames": [
                        "Январь",
                        "Февраль",
                        "Март",
                        "Апрель",
                        "Май",
                        "Июнь",
                        "Июль",
                        "Август",
                        "Сентябрь",
                        "Октябрь",
                        "Ноябрь",
                        "Декабрь"
                    ],
                    format: 'YYYY-MM-DD H:mm',
                    "firstDay": 1,
                    "weekLabel": "Неделя",
                    "daysOfWeek": [
                        "Вс",
                        "Пн",
                        "Вт",
                        "Ср",
                        "Чт",
                        "Пт",
                        "Сб"
                    ]

                }
            });
            $('input[name="race_date"]').daterangepicker({
                "singleDatePicker": true,
                "autoApply": true,
                "timePicker": true,
                "timePicker24Hour": true,
                "startDate": new Date(),
                "endDate" : new Date(),
                locale: {
                    "monthNames": [
                        "Январь",
                        "Февраль",
                        "Март",
                        "Апрель",
                        "Май",
                        "Июнь",
                        "Июль",
                        "Август",
                        "Сентябрь",
                        "Октябрь",
                        "Ноябрь",
                        "Декабрь"
                    ],
                    format: 'YYYY-MM-DD H:mm',
                    "firstDay": 1,
                    "weekLabel": "Неделя",
                    "daysOfWeek": [
                        "Вс",
                        "Пн",
                        "Вт",
                        "Ср",
                        "Чт",
                        "Пт",
                        "Сб"
                    ]

                }
            });
            var id_car = document.getElementById('id_car');
            var id_supplier = document.getElementById('id_supplier');
            var select_load = document.getElementById('id_place_load');
            id_car.addEventListener("change", function () {
                var data = id_supplier.value;
                $.ajax(
                    {
                        type: "GET",
                        url: "{% url 'RaceAjaxTrack' %}",
                        data: {id: data},
                        dataType: 'json',
                        success: function (resp) {
                            document.getElementById('id_gas_start').value = resp.gas_start;
                            document.getElementById('id_s_milage').value = resp.s_milage;
                        }
                    })
            });
            id_supplier.addEventListener("change", function () {
                var data = id_supplier.value;
                $.ajax(
                    {
                        type: "GET",
                        url: "{% url 'RaceAjaxSup' %}",
                        data: {id: data},
                        dataType: 'json',
                        success: function (resp) {
                            while (select_load.length > 1) {
                                select_load.remove(select_load.length - 1)
                            }
                            for (i = 0; i < resp.length; i++) {
                                var option = document.createElement('option');
                                option.text = resp[i].address;
                                option.value = resp[i].id_load_place;
                                select_load.add(option)
                            }
                        }
                    })
            });
        })
    </script>
{% endblock %}
