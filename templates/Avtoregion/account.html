{% extends "index.html" %}
{% load bootstrap3 %}
{% load custom_filters %}
{% block content %}
	<div class="toggle-toolbar collapse collapse-toggle">
		<div class="container">
			<div class="well col-lg-4 col-lg-offset-4 col-md-4 col-md-offset-4 col-xs-4 col-xs-offset-4">
				<form action="{% url 'Acc' %}" method="post" id="account-form">
					{% csrf_token %}

					<div class="row">
						<div class="form-group">
							<div class="input-group">
								<span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
								<input name="daterange" type="text" class="form-control" id="account_daterange"/>
							</div>
						</div>
						</div>

					<div class="row">
						<div class="form-group">
							<select id="account_type" class="form-control">
								<option value="supplier">Поставщик</option>
								<option value="customer">Покупатель</option>
								<option value="mediator">Посредник</option>
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select id="account_supplier" name="supplier" class="form-control icon-select">
								{% for field in q_sup %}
									<option data-icon="fa-building"
									        value="{{ field.id_supplier }}">{{ field.name }}
									</option>
								{% endfor %}
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select class="form-control icon-select" id="account_load_place">
								<option></option>
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select id="account_customer" class="form-control icon-select">
								{% for field in q_cus %}
									<option data-icon="fa-credit-card" value="{{ field.id_customer }}">{{ field.name }}</option>
								{% endfor %}
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select class="form-control icon-select" id="account_unload_place">
								<option></option>
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select id="account_mediator" class="form-control icon-select">
								{% for field in q_med %}
									<option data-icon="fa-credit-card" value="{{ field.id_mediator }}">{{ field.name }}</option>
								{% endfor %}
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select id="account_service" name="service" class="form-control">
								{% for field in race_type %}
									<option value="{{ field }}">{{ field }}</option>
								{% endfor %}
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select id="account_state" name="state" class="form-control">
								<option></option>
								{% for field in state %}
									<option value="{{ field }}">{{ field }}</option>
								{% endfor %}
							</select>
						</div>
					</div>

					<div class="row">
						<div class="form-group">
							<select name="product" multiple class="form-control" id="account_product">
								{% for field in q_prod %}
									<option value="{{ field.name }}">{{ field.name }}</option>
								{% endfor %}
							</select>
						</div>
					</div>
					{% buttons %}
						<button class="btn btn-success btn-sm"> {% bootstrap_icon "star" %}Сформировать</button>
					{% endbuttons %}
				</form>
			</div>
		</div>
	</div>

	<div class="text-center">
		<a id="link_toggle_toolbar" href="#" class="">
			<div class="glyphicon glyphicon-circle-arrow-down fa-3x rotate"></div>
		</a>
	</div>
	<script type="text/javascript">

      $(function ()
      {
          $('.rotate').click(function ()
          {
              $('.toggle-toolbar').collapse('toggle');
          });

          var id_customer = document.getElementById('account_customer');
          var select_unload = document.getElementById('account_unload_place');
          var cus = id_customer.value;
          $.ajax(
              {
                  type: "GET",
                  url: "{% url 'RaceAjaxCus' %}",
                  data: {id: cus},
                  dataType: 'json',
                  success: function (resp)
                  {
                      while (select_unload.length > 1)
                      {
                          select_unload.remove(select_unload.length - 1)
                      }
                      for (var i = 0; i < resp.length; i++)
                      {
                          var option = document.createElement('option');
                          option.text = resp[i].name;
                          option.value = resp[i].id_shipment;
                          select_unload.add(option);
                          $('#account_unload_place').trigger("chosen:updated");
                      }
                  }
              });

          $('#account_customer').chosen().change(function ()
          {
              var cus = id_customer.value;
              $.ajax(
                  {
                      type: "GET",
                      url: "{% url 'RaceAjaxCus' %}",
                      data: {id: cus},
                      dataType: 'json',
                      success: function (resp)
                      {
                          while (select_unload.length > 1)
                          {
                              select_unload.remove(select_unload.length - 1)
                          }
                          for (var i = 0; i < resp.length; i++)
                          {
                              var option = document.createElement('option');
                              option.text = resp[i].name;
                              option.value = resp[i].id_shipment;
                              select_unload.add(option);
                              $('#account_unload_place').trigger("chosen:updated");
                          }
                      }
                  })

          });
      });


	</script>
	<div id="tab_res">
		{% include "table.html" %}
	</div>
{% endblock %}
